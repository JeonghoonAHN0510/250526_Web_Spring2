<?xml version="1.0" encoding="UTF-8" ?>
<!-- XML이란? 마크업을 이용한 데이터 저장(설정)/전달(API)/교환 마크업 언어 -->
<!-- HTML이란? 마크업을 이용한 웹페이지 마크업 언어 -->

<!-- XML 파일 내 MyBatis 라이브러리 설정 -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- XML과 매핑할 인터페이스 설정, [java] 이하 경로 지정 -->
<mapper namespace="example.day13.XmlMapper">
    <!-- [1] 등록 -->
    <!-- id="추상메소드명", parameterType="매개변수타입경로||타입명" -->
    <!-- 자동생성된 PK값 반환받기 : useGeneratedKeys="true" keyProperty="PK컬럼명" -->
    <!-- 자동생성된 값은 Dto에 저장되어 반환된다. || 삽입/수정/삭제의 int 반환값은 실행된 레코드 수 -->
    <insert id="save" parameterType="example.day13.StudentDto" useGeneratedKeys="true" keyProperty="sno">
        INSERT INTO student(name, kor, math)
            VALUES (#{name}, #{kor}, #{math});
    </insert>

    <!-- [2] 전체조회 -->
    <select id="getAll" resultType="example.day13.StudentDto">
        SELECT * FROM student;
    </select>

    <!-- [3] 개별조회 -->
    <select id="getBySno" parameterType="int" resultType="example.day13.StudentDto">
        SELECT * FROM student WHERE sno = #{sno};
    </select>

    <!-- [4] 개별삭제 -->
    <delete id="deleteBySno" parameterType="int">
        DELETE FROM student WHERE sno = #{sno};
    </delete>

    <!-- [5] 개별수정 -->
    <update id="updateBySno" parameterType="example.day13.StudentDto">
        UPDATE student SET kor = #{kor}, math = #{math} WHERE sno = #{sno};
    </update>

    <!-- [6] IF 동적쿼리 : 국어점수로 학생 조회 -->
    <select id="query2" parameterType="int" resultType="example.day13.StudentDto">
        SELECT * FROM student WHERE 1 = 1
        <if test="kor != null">
            and kor >= #{kor}
        </if>
    </select>

    <!-- [7] IF 동적쿼리 : 이름 또는 수학점수로 학생 조회 -->
    <!-- parameterType이 2개 이상일 때, dto로 묶거나 생략 -->
    <!-- concat(문자열, 문자열) : 문자열 연결함수 -->
    <select id="query3" resultType="example.day13.StudentDto">
        SELECT * FROM student
        <where>
            <!-- 만약 name이 null이 아니면, name으로 조회 -->
            <if test="name != null">
                and name like concat('%', #{name}, '%')
            </if>
            <!-- 만약 math가 null이 아니면, math로 조회 -->
            <if test="math != null">
                and math >= #{math}
            </if>
        </where>
    </select>

    <!-- [8] forEach 동적쿼리 : 다수 학생 등록 -->
    <insert id="saveAll" parameterType="list" useGeneratedKeys="true" keyProperty="sno">
        INSERT INTO student (name, kor, math) VALUES
            <foreach collection="list" item="student" separator=", ">
                (#{student.name}, #{student.kor}, #{student.math})
            </foreach>
    </insert>
    <!-- collection="컬렉션명" item="반복변수명" separator="반복SQL의 구분문자" -->
</mapper> <!-- mapper 끝 -->